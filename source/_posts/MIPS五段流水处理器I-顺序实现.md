---
title: MIPS五段流水处理器I 顺序实现
date: 2021-01-14 17:40:04
tags:
 - MIPS
 - 流水线处理器
 - verilog
keywords:
 - MIPS
 - 流水线处理器
categories: 造轮子
description:
summary_img:
---

尝试使用 Verilog 实现一个 mips 五段流水处理器。

<!-- more -->

## MIPS 指令集

MIPS 指令集分为三类，总共 31 条，分别是

- I 型
  - 指令内容中带有立即数
  - 最多使用两个寄存器
  - Op 字段用于区别不同指令
- J 型
  - 长跳转类型
  - 有且仅有一个立即数
  - Op 字段用于区别不同指令
- R 型
  - 仅使用寄存器的指令
  - Op 字段为 0，使用 funct 字段区别

这三种指令的具体划分以及内容参照[这篇博客](https://www.jianshu.com/p/ac2c9e7b1d8f), 本文中不再赘述。

## 流水线划分

经典的五段流水线划分为

1. 取指 `Fetch`
   - 从 PC 程序计数器指向的地址中取出指令
   - 放入 IR 指令寄存器中
   - PC += 指令长度
2. 译码 `Decode`
   - 根据 IR 中的指令内容，得到其所需要的
     - 源操作数(寄存器)
     - 目标操作数寄存器
3. 执行 `Execute`
   - 将源操作数(对应的寄存器)加载进 ALU，然后将对应的运算结果保存进目标操作数寄存器
4. 访存 `Memory` (仅针对 load/store 指令)
   - load: 从存储器中读出 ALU 计算出的有效地址存储的数据
   - store: 将寄存器中的数据输入 ALU 计算出的有效地址中
5. 写回 `Write Back` (仅针对除 store 以外的指令)
   - load: 将读出的数据存储到目标寄存器中
   - 其他指令: 将 ALU 计算出的结果输出到目标寄存器中

稍微多提一句的是，由于我们想要首先制作的是顺序处理器，因此这 5 个步骤中很多地方是没有必要的，比如更新 PC 可以放在最后一步，但是因为我们希望能给流水线寄存器预留拓展，因此还是采用这样符合流水线的设计来制造我们的 cpu。
